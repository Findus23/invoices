\documentclass[
        a4paper,
        12pt,
        version=last,
        fromalign=right,
%       foldmarks=p, % keine mittlere Faltmarke
        foldmarks=off,
        enlargefirstpage,
        fromemail,
        fromphone,
%       fromcity,
        fromlogo,
        fromrule,
        backaddress,
]{scrlttr2}
\usepackage[utf8]{inputenc}
\BLOCK{ if details.locale == "de" }
\usepackage[ngerman]{babel}
\BLOCK{ else }
\usepackage[english]{babel}
\BLOCK{ endif }
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{mathpazo}
\usepackage[left]{eurosym}
\usepackage{booktabs}
\usepackage{microtype}
\usepackage{tabularx}

\usepackage{color}
\definecolor{LightGray}{rgb}{0.7,0.7,0.7}
\definecolor{Gray}{rgb}{0.5,0.5,0.5}
\setkomafont{fromrule}{\color{LightGray}}
\setkomafont{fromaddress}{\sffamily} % Sans Serif
\setkomafont{fromname}{\sffamily\bfseries} % and bold
\setkomafont{pagefoot}{\sffamily\bfseries}

\usepackage{graphicx}

\newcommand{\separ}{~\textperiodcentered~}

\hyphenpenalty=10000

\newcommand{\VAR}[1]{\LaTeX} % Just a placeholder (will never be used)

\newcommand{\BLOCK}[1]{\LaTeX} % Just a placeholder (will never be used)

\newcommand{\Name}{\VAR{user.name}}
\setkomavar{fromname}{\Name}
\newcommand{\Address}{\VAR{user.address}}
\newcommand{\ZIP}{\VAR{user.zip}}
\newcommand{\City}{\VAR{user.city}}
\newcommand{\Country}{\VAR{user.country}}

\setkomavar{fromaddress}{\Address\\\ZIP~\City\\\Country}
\setkomavar{fromphone}[]{\VAR{user.phone}}
\setkomavar{fromemail}[]{\VAR{user.email}}
\setkomavar{fromurl}[]{\VAR{user.url}}
%\setkomavar{fromlogo}{\includegraphics[height=3.2cm]{template/header.jpg}}


\setkomavar{frombank}{\VAR{user.bank}\separ IBAN: \VAR{user.IBAN}\separ BIC: \VAR{user.BIC}}
%TODO: Linie Ã¼ber
\setkomavar{firstfoot}{\centering\color{Gray}\scriptsize\Name\separ\Address\separ\ZIP~\City\\
    \usekomavar{fromphone}\separ\usekomavar{fromemail}\separ\usekomavar{fromurl}\\\usekomavar{frombank}}

\setkomavar{invoice}{\VAR{details.invoice_id}}
\setkomavar{date}{\VAR{datestr}}
\newkomavar*[\VAR{"timeframe"|t}]{timeframe}
\setkomavar{timeframe}{\VAR{details.timeframe}}


\pdfinfo{
   /Author (\Name)
   /Title  (\VAR{"invoice" |t} \VAR{user.name} \VAR{datestr})
   /Subject (\VAR{"invoice" |t} \VAR{user.name} \VAR{datestr})
   /Keywords (\VAR{"invoice" |t})
}

\setkomavar{backaddress}{\usekomavar{fromname}, \Address, \ZIP~\City}

% Begin document
\begin{document}
\begin{letter}{\VAR{client.name} \\ \VAR{client.address} \\ \VAR{client.zip}~\VAR{client.city}\\\VAR{client.country}}
\setkomavar{title}{\VAR{details.title}}
\opening{}

% \BLOCK{if details.mode=="single"}
% \begin{tabularx}{\textwidth}{lX}
%       \VAR{"descr"|t}:& \VAR{details.description} \\
%       \VAR{"period"|t}: & \VAR{details.timeframe} \\
%       \VAR{"total"|t}: & \EUR{\VAR{details.price | formatdigit }} \\
%
%       \vspace{0.5cm}
%
% \end{tabularx}
% \BLOCK{elif details.mode=="hourly"}

% Consider a table with:
% Amount | Unit | description ('Leistung') | price per unit | total

\vspace{0.5cm}
\begin{tabularx}{\textwidth}{Xrrr}
        \VAR{"descr"|t} & \VAR{"per_hour"|t} & \VAR{"hours"|t} & \VAR{"total"|t} \\ \midrule

        \VAR{details.description} &
        \EUR{\VAR{details.hourly_rate_cents | formatdigit }} &
        \VAR{details.hours_worked}:\VAR{'%02d' % details.mins_worked} &
        \EUR{\VAR{total_cost | formatdigit }} \\

        \BLOCK{if details.bank_fee}
            \VAR{"bank_fee"|t} & & & \EUR{\VAR{details.bank_fee| formatdigit}} \\
        \BLOCK{endif}


        \midrule %\cmidrule{4-4}


        & & & \EUR{\VAR{total_cost | formatdigit }} \\
\end{tabularx}

% \BLOCK{endif} % if mode="hourly"

% \vspace{0.5cm}
% \noindent \VAR{"taxexception"|t}

% \vspace{0.5cm}
\vspace{3cm}
\noindent \VAR{"transfer"|t}:

\vspace{0.5cm}

\begin{tabular}{@{}ll}
        Bank: &\VAR{user.bank}\\
        IBAN:& \VAR{user.IBAN}\\
        BIC:& \VAR{user.BIC}
\end{tabular}


\end{letter}
\end{document}
